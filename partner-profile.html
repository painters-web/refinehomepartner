<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Profile | Refine Partner</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --p: #0D9488; --p-dark: #0F766E; --p-light: #14B8A6;
            --bg: #0F172A; --card: #1E293B; --text: #F1F5F9; 
            --text-light: #94A3B8; --border: #334155;
            --success: #10B981; --warning: #F59E0B; --danger: #EF4444;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { 
            background: linear-gradient(180deg, #0F172A 0%, #1E293B 100%); 
            min-height: 100vh; 
            padding-bottom: 100px; 
            color: var(--text);
        }

        .header {
            background: linear-gradient(135deg, var(--p-dark) 0%, var(--p) 100%);
            color: white;
            padding: 30px 24px;
            border-radius: 0 0 32px 32px;
            box-shadow: 0 10px 30px rgba(13, 148, 136, 0.3);
            text-align: center;
            position: relative;
        }
        
        .back-btn {
            position: absolute;
            left: 24px;
            top: 50%;
            transform: translateY(-50%);
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.1);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .back-btn:hover { background: rgba(255,255,255,0.2); }

        .profile-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%);
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            border: 4px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        }
        
        .profile-name { font-size: 1.5rem; font-weight: 800; margin-bottom: 8px; }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }
        
        .status-badge.verified { background: rgba(16, 185, 129, 0.2); color: #34D399; }
        .status-badge.pending { background: rgba(245, 158, 11, 0.2); color: #FBBF24; }

        .content { padding: 24px; }

        .section-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--text);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-card {
            background: var(--card);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid var(--border);
        }

        .input-group { margin-bottom: 20px; }
        
        .input-label {
            display: block;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 16px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: #0F172A;
            color: var(--text);
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--p);
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
        }
        
        .input-field:disabled {
            background: #1E293B;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .info-text {
            background: rgba(13, 148, 136, 0.1);
            border-left: 4px solid var(--p);
            padding: 16px;
            border-radius: 12px;
            font-size: 0.9rem;
            color: var(--text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-submit {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(13, 148, 136, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(13, 148, 136, 0.4);
        }
        
        .btn-submit:disabled {
            background: #475569;
            cursor: not-allowed;
            box-shadow: none;
        }

        .bank-display {
            background: linear-gradient(135deg, #0F766E 0%, #115E59 100%);
            border-radius: 24px;
            padding: 28px;
            color: white;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .bank-display::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
        }
        
        .bank-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }
        
        .bank-label { font-size: 0.8rem; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; }
        .bank-value { font-weight: 700; font-size: 1.1rem; }
        .bank-value.number { font-family: 'Courier New', monospace; letter-spacing: 3px; font-size: 1.5rem; }

        .verification-alert {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 100%);
            border: 2px solid var(--warning);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .verification-alert.verified {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
            border-color: var(--success);
        }
        
        .alert-icon {
            width: 70px;
            height: 70px;
            background: rgba(245, 158, 11, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: var(--warning);
        }
        
        .verification-alert.verified .alert-icon { 
            background: rgba(16, 185, 129, 0.2); 
            color: var(--success); 
        }
        
        .alert-title { font-size: 1.4rem; font-weight: 800; color: var(--warning); margin-bottom: 8px; }
        .verification-alert.verified .alert-title { color: var(--success); }
        
        .alert-text { color: var(--text-light); font-size: 0.95rem; line-height: 1.6; }

        .nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding-bottom: 10px;
        }
        
        .nav-item {
            text-align: center;
            color: #64748B;
            font-size: 0.75rem;
            font-weight: 700;
            width: 64px;
            cursor: pointer;
            padding: 10px;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .nav-item.active { 
            color: var(--p-light); 
            background: rgba(13, 148, 136, 0.1); 
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(13, 148, 136, 0.2);
        }
        
        .nav-item i { display: block; font-size: 1.5rem; margin-bottom: 4px; }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active { display: flex; opacity: 1; }
        
        .modal-container {
            background: linear-gradient(145deg, #1E293B 0%, #0F172A 100%);
            border-radius: 28px;
            padding: 32px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border);
        }
        
        .modal-overlay.active .modal-container { transform: scale(1) translateY(0); }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2.5rem;
            background: rgba(13, 148, 136, 0.1);
            color: var(--p-light);
            border: 2px solid var(--p);
        }
        
        .modal-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); border-color: var(--success); }
        .modal-icon.error { background: rgba(239, 68, 68, 0.1); color: var(--danger); border-color: var(--danger); }
        
        .modal-title { font-size: 1.5rem; font-weight: 800; color: var(--text); margin-bottom: 12px; }
        .modal-text { color: var(--text-light); font-size: 1rem; margin-bottom: 24px; line-height: 1.5; }
        
        .modal-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-weight: 800;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.95);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
            backdrop-filter: blur(10px);
        }
        
        .loading-overlay.active { display: flex; }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--p);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 10000;
        }
        
        .toast {
            background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            padding: 20px 24px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.2, 0.9, 0.3, 1);
            border-left: 4px solid var(--p);
            border: 1px solid var(--border);
            color: var(--text);
            min-width: 300px;
        }
        
        .toast.show { transform: translateX(0); }
    </style>
</head>
<body>

    <div class="header">
        <div class="back-btn" onclick="window.location.href='partner-dashboard.html'">
            <i class="fa-solid fa-arrow-left"></i>
        </div>
        <div class="profile-avatar">
            <i class="fa-solid fa-user"></i>
        </div>
        <div class="profile-name" id="pName">Partner Name</div>
        <div class="status-badge pending" id="statusBadge">
            <i class="fa-solid fa-clock"></i>
            <span>Pending Verification</span>
        </div>
    </div>

    <div class="content">
        <div class="verification-alert" id="verificationAlert">
            <div class="alert-icon">
                <i class="fa-solid fa-hourglass-half"></i>
            </div>
            <div class="alert-title">Profile Under Review</div>
            <div class="alert-text">
                Please complete all details below. Admin will verify your profile within 24 hours.
            </div>
        </div>

        <div class="section-title">
            <i class="fa-solid fa-user" style="color: var(--p-light);"></i>
            Personal Details
        </div>

        <div class="form-card">
            <div class="info-text">
                <i class="fa-solid fa-circle-info" style="color: var(--p-light);"></i>
                <span>Enter details exactly as per your Aadhar Card</span>
            </div>

            <div class="input-group">
                <label class="input-label">Full Name (As per Aadhar)</label>
                <input type="text" id="fullName" class="input-field" placeholder="Enter your full name">
            </div>

            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">Phone Number</label>
                    <input type="tel" id="phoneNumber" class="input-field" placeholder="10 digit number" maxlength="10">
                </div>
                <div class="input-group">
                    <label class="input-label">Email Address</label>
                    <input type="email" id="emailAddress" class="input-field" placeholder="email@example.com">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">Complete Address</label>
                <input type="text" id="address" class="input-field" placeholder="House No, Street, Area">
            </div>

            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">City</label>
                    <input type="text" id="city" class="input-field" placeholder="City name">
                </div>
                <div class="input-group">
                    <label class="input-label">Pincode</label>
                    <input type="text" id="pincode" class="input-field" placeholder="6 digits" maxlength="6">
                </div>
            </div>
        </div>

        <div class="section-title">
            <i class="fa-solid fa-id-card" style="color: var(--warning);"></i>
            KYC Details
        </div>

        <div class="form-card">
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">Aadhar Number</label>
                    <input type="text" id="aadharNumber" class="input-field" placeholder="XXXX XXXX XXXX" maxlength="14">
                </div>
                <div class="input-group">
                    <label class="input-label">PAN Number</label>
                    <input type="text" id="panNumber" class="input-field" placeholder="ABCDE1234F" maxlength="10">
                </div>
            </div>
        </div>

        <div class="section-title">
            <i class="fa-solid fa-building-columns" style="color: var(--p-light);"></i>
            Bank Account Details
        </div>

        <div class="form-card" id="bankForm">
            <div class="info-text">
                <i class="fa-solid fa-shield-halved" style="color: var(--success);"></i>
                <span>Your payout (79.5% of job amount) will be transferred here</span>
            </div>

            <div class="input-group">
                <label class="input-label">Account Holder Name</label>
                <input type="text" id="accountHolder" class="input-field" placeholder="Name as per bank passbook">
            </div>

            <div class="input-group">
                <label class="input-label">Bank Name</label>
                <input type="text" id="bankName" class="input-field" placeholder="e.g., State Bank of India">
            </div>

            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">Account Number</label>
                    <input type="text" id="accountNumber" class="input-field" placeholder="Account number">
                </div>
                <div class="input-group">
                    <label class="input-label">IFSC Code</label>
                    <input type="text" id="ifscCode" class="input-field" placeholder="SBIN0001234" maxlength="11">
                </div>
            </div>

            <div class="input-group">
                <label class="input-label">UPI ID (Optional but recommended)</label>
                <input type="text" id="upiId" class="input-field" placeholder="name@upi">
            </div>
        </div>

        <div class="bank-display" id="bankDisplay" style="display: none;">
            <div class="bank-row">
                <div>
                    <div class="bank-label">Account Holder</div>
                    <div class="bank-value" id="displayAccHolder">Name</div>
                </div>
                <div style="text-align: right;">
                    <div class="bank-label">Bank</div>
                    <div class="bank-value" id="displayBankName">Bank</div>
                </div>
            </div>
            <div class="bank-row">
                <div class="bank-value number" id="displayAccNumber">XXXX XXXX 1234</div>
            </div>
            <div class="bank-row" style="margin-bottom: 0;">
                <div>
                    <div class="bank-label">IFSC</div>
                    <div class="bank-value" id="displayIfsc">CODE</div>
                </div>
                <div style="text-align: right;">
                    <div class="bank-label">UPI</div>
               <div class="bank-value" id="displayUpi">upi@id</div>
                </div>
            </div>
        </div>

        <button class="btn-submit" onclick="submitProfile()" id="submitBtn">
            <i class="fa-solid fa-paper-plane"></i> Submit for Verification
        </button>
    </div>

    <div class="nav">
        <div class="nav-item" onclick="window.location.href='partner-dashboard.html'">
            <i class="fa-solid fa-house"></i>Home
        </div>
        <div class="nav-item" onclick="window.location.href='partner-leads.html'">
            <i class="fa-solid fa-bolt"></i>Leads
        </div>
        <div class="nav-item" onclick="window.location.href='partner-jobs.html'">
            <i class="fa-solid fa-briefcase"></i>Jobs
        </div>
        <div class="nav-item active" onclick="window.location.href='partner-profile.html'">
            <i class="fa-solid fa-user"></i>Profile
        </div>
    </div>

    <div class="modal-overlay" id="customModal">
        <div class="modal-container">
            <div class="modal-icon" id="modalIcon">
                <i class="fa-solid fa-check"></i>
            </div>
            <div class="modal-title" id="modalTitle">Success</div>
            <div class="modal-text" id="modalText">Operation completed successfully</div>
            <button class="modal-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="font-weight: 700; color: var(--text); font-size: 1.1rem;">Submitting...</div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
            authDomain: "urban-paint-pro.firebaseapp.com",
            databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "urban-paint-pro",
            storageBucket: "urban-paint-pro.firebasestorage.app",
            messagingSenderId: "929763117480",
            appId: "1:929763117480:web:560057baeb12672078b59d"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let partner = JSON.parse(localStorage.getItem('partnerData'));
        if(!partner) window.location.href = 'partner-index.html';

        // Format Aadhar input
        document.getElementById('aadharNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
            e.target.value = value;
        });

        // Load existing data if any
        function loadData() {
            document.getElementById('pName').textContent = partner.name || 'Partner';
            
            // Check kycStatus with trim to handle spaces
            const kycStatus = (partner.kycStatus || '').toString().trim();
            
            if(kycStatus === 'verified') {
                showVerifiedState();
            } else {
                // Pre-fill if data exists
                if(partner.fullName) document.getElementById('fullName').value = partner.fullName;
                if(partner.phone) document.getElementById('phoneNumber').value = partner.phone;
                if(partner.email) document.getElementById('emailAddress').value = partner.email;
                if(partner.address) document.getElementById('address').value = partner.address;
                if(partner.city) document.getElementById('city').value = partner.city;
                if(partner.pincode) document.getElementById('pincode').value = partner.pincode;
                if(partner.aadharNumber) document.getElementById('aadharNumber').value = partner.aadharNumber;
                if(partner.panNumber) document.getElementById('panNumber').value = partner.panNumber;
                
                if(partner.bankDetails) {
                    document.getElementById('accountHolder').value = partner.bankDetails.holderName || '';
                    document.getElementById('bankName').value = partner.bankDetails.bankName || '';
                    document.getElementById('accountNumber').value = partner.bankDetails.accountNumber || '';
                    document.getElementById('ifscCode').value = partner.bankDetails.ifscCode || '';
                    document.getElementById('upiId').value = partner.bankDetails.upiId || '';
                }
            }
        }

        function showVerifiedState() {
            document.getElementById('statusBadge').className = 'status-badge verified';
            document.getElementById('statusBadge').innerHTML = '<i class="fa-solid fa-check-circle"></i><span>Verified & Live</span>';
            
            document.getElementById('verificationAlert').className = 'verification-alert verified';
            document.getElementById('verificationAlert').innerHTML = `
                <div class="alert-icon"><i class="fa-solid fa-check"></i></div>
                <div class="alert-title">Profile Verified & Active</div>
                <div class="alert-text">Your profile is live! You can now accept jobs and get immediate payouts (79.5% of job value).</div>
            `;
            
            // Disable all inputs
            document.querySelectorAll('.input-field').forEach(input => input.disabled = true);
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('bankForm').style.display = 'none';
            
            // Show bank display
            document.getElementById('bankDisplay').style.display = 'block';
            if(partner.bankDetails) {
                document.getElementById('displayAccHolder').textContent = partner.bankDetails.holderName;
                document.getElementById('displayBankName').textContent = partner.bankDetails.bankName;
                document.getElementById('displayAccNumber').textContent = 'XXXX XXXX ' + partner.bankDetails.accountNumber.slice(-4);
                document.getElementById('displayIfsc').textContent = partner.bankDetails.ifscCode;
                document.getElementById('displayUpi').textContent = partner.bankDetails.upiId || 'Not added';
            }
        }

        function submitProfile() {
            // Get all values
            const data = {
                fullName: document.getElementById('fullName').value.trim(),
                phone: document.getElementById('phoneNumber').value.trim(),
                email: document.getElementById('emailAddress').value.trim(),
                address: document.getElementById('address').value.trim(),
                city: document.getElementById('city').value.trim().toLowerCase(),
                pincode: document.getElementById('pincode').value.trim(),
                aadharNumber: document.getElementById('aadharNumber').value.replace(/\s/g, ''),
                panNumber: document.getElementById('panNumber').value.trim().toUpperCase(),
                bankDetails: {
                    holderName: document.getElementById('accountHolder').value.trim(),
                    bankName: document.getElementById('bankName').value.trim(),
                    accountNumber: document.getElementById('accountNumber').value.trim(),
                    ifscCode: document.getElementById('ifscCode').value.trim().toUpperCase(),
                    upiId: document.getElementById('upiId').value.trim()
                },
                kycStatus: 'pending'  // Submit as pending for admin approval
            };

            // Validation
            if(!data.fullName || !data.phone || !data.email || !data.address || !data.city || !data.pincode) {
                showModal('Missing Details', 'Please fill all personal details', 'warning');
                return;
            }
            
            if(data.phone.length !== 10 || !/^\d{10}$/.test(data.phone)) {
                showModal('Invalid Phone', 'Please enter valid 10-digit phone number', 'warning');
                return;
            }
            
            if(data.aadharNumber.length !== 12) {
                showModal('Invalid Aadhar', 'Please enter valid 12-digit Aadhar number', 'warning');
                return;
            }
            
            if(!/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(data.panNumber)) {
                showModal('Invalid PAN', 'Please enter valid PAN number (e.g., ABCDE1234F)', 'warning');
                return;
            }
            
            if(!data.bankDetails.holderName || !data.bankDetails.bankName || !data.bankDetails.accountNumber || !data.bankDetails.ifscCode) {
                showModal('Missing Bank Details', 'Please fill all bank details', 'warning');
                return;
            }
            
            if(data.bankDetails.accountNumber.length < 9) {
                showModal('Invalid Account', 'Please enter valid account number', 'warning');
                return;
            }
            
            if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(data.bankDetails.ifscCode)) {
                showModal('Invalid IFSC', 'Please enter valid IFSC code', 'warning');
                return;
            }

            document.getElementById('loadingOverlay').classList.add('active');

            db.ref('partners/' + partner.id).update(data).then(() => {
                partner = {...partner, ...data};
                localStorage.setItem('partnerData', JSON.stringify(partner));
                
                document.getElementById('loadingOverlay').classList.remove('active');
                showModal('Submitted!', 'Profile submitted successfully! Admin will verify within 24 hours.', 'success');
                
                // Disable form
                document.querySelectorAll('.input-field').forEach(input => input.disabled = true);
                document.getElementById('submitBtn').disabled = true;
                document.getElementById('submitBtn').innerHTML = '<i class="fa-solid fa-clock"></i> Pending Verification';
            }).catch(err => {
                document.getElementById('loadingOverlay').classList.remove('active');
                showModal('Error', err.message, 'error');
            });
        }

        // Real-time listener for kycStatus
        db.ref('partners/' + partner.id + '/kycStatus').on('value', (snapshot) => {
            const status = (snapshot.val() || '').toString().trim();
            if(status === 'verified' && partner.kycStatus !== 'verified') {
                partner.kycStatus = 'verified';
                localStorage.setItem('partnerData', JSON.stringify(partner));
                showModal('Verified!', 'Your profile has been verified! Page will refresh.', 'success');
                setTimeout(() => location.reload(), 2000);
            }
        });

        // Modal Functions
        function showModal(title, text, type) {
            const modal = document.getElementById('customModal');
            const icon = document.getElementById('modalIcon');
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').textContent = text;
            
            icon.className = 'modal-icon ' + type;
            if(type === 'success') icon.innerHTML = '<i class="fa-solid fa-check"></i>';
            else if(type === 'error') icon.innerHTML = '<i class="fa-solid fa-xmark"></i>';
            else if(type === 'warning') icon.innerHTML = '<i class="fa-solid fa-exclamation"></i>';
            
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('customModal').classList.remove('active');
        }

        document.getElementById('customModal').addEventListener('click', function(e) {
            if(e.target === this) closeModal();
        });

        loadData();
    </script>
</body>
</html>
