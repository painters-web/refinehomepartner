<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - RefineHome Partner</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Same Rehega Jaisa Pehle Tha */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0fdfa; min-height: 100vh; padding-bottom: 90px; color: #134e4a; }
        .header { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: white; display: flex; align-items: center; padding: 0 20px; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .content { margin-top: 90px; padding: 0 20px; max-width: 800px; margin: 90px auto 0; }
        .lead-card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-left: 5px solid #0D9488; }
        .service-title { font-size: 1.2rem; font-weight: 800; color: #0D9488; margin-bottom: 10px; }
        .info-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; color: #475569; }
        .lead-amount { font-size: 1.3rem; font-weight: 800; margin: 15px 0; }
        .btn-view { width: 100%; padding: 12px; background: #0D9488; color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid #eee; }
        .nav-item { text-decoration: none; color: #94a3b8; text-align: center; font-size: 0.8rem; }
        .nav-item.active { color: #0D9488; }
        .loading-state { text-align: center; padding: 50px; color: #64748b; }
    </style>
</head>
<body>
    <header class="header"><h2 style="color:#0D9488">My Leads</h2></header>

    <main class="content" id="mainContent">
        <div id="loadingState" class="loading-state">
            <i class="fas fa-spinner fa-spin fa-2x"></i>
            <p>Fetching orders...</p>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="dashboard.html" class="nav-item active"><i class="fa-solid fa-house"></i><div>Home</div></a>
        <a href="earnings.html" class="nav-item"><i class="fa-solid fa-wallet"></i><div>Earnings</div></a>
        <a href="reviews.html" class="nav-item"><i class="fa-solid fa-star"></i><div>Reviews</div></a>
        <a href="kyc.html" class="nav-item"><i class="fa-solid fa-id-card"></i><div>KYC</div></a>
        <a href="profile.html" class="nav-item"><i class="fa-solid fa-user"></i><div>Profile</div></a>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
            authDomain: "urban-paint-pro.firebaseapp.com",
            databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "urban-paint-pro",
            storageBucket: "urban-paint-pro.firebasestorage.app",
            messagingSenderId: "929763117480",
            appId: "1:929763117480:web:560057baeb12672078b59d"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        let currentLeads = {};

        auth.onAuthStateChanged(user => {
            if (!user) { window.location.href = 'index.html'; return; }
            loadLeads();
        });

        function loadLeads() {
            // Seedha 'orders' node ko hit kar rahe hain
            db.ref('orders').on('value', snapshot => {
                const loader = document.getElementById('loadingState');
                if (loader) loader.style.display = 'none';
                
                currentLeads = snapshot.val() || {};
                renderLeads();
            }, error => {
                console.error("Firebase Error:", error);
                document.getElementById('mainContent').innerHTML = "<p style='text-align:center'>Error loading data. Check Rules.</p>";
            });
        }

        function renderLeads() {
    const container = document.getElementById('mainContent');
    let html = '';
    
    // Partner ki apni category check karein
    const partnerCategory = partnerData?.category || ''; 
    
    // Orders ko filter karein partner ki category ke hisaab se
    const filteredEntries = Object.entries(currentLeads).filter(([id, lead]) => {
        // Condition 1: Lead ka status 'new' hona chahiye
        // Condition 2: Lead ki category aur Partner ki category match honi chahiye
        const leadCategory = lead.service || lead.category || '';
        return lead.status === 'new' && leadCategory.toLowerCase() === partnerCategory.toLowerCase();
    });

    if (filteredEntries.length === 0) {
        html = `
            <div style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                <i class="fa-solid fa-filter-circle-xmark" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                <p>No new ${partnerCategory} leads available for you right now.</p>
            </div>`;
    } else {
        filteredEntries.forEach(([id, lead]) => {
            html += createLeadCard(id, lead);
        });
    }
    container.innerHTML = html;
}

    </script>
</body>
</html>
