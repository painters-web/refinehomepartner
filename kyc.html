<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Verification - RefineHome Partner</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: #f0fdfa; min-height: 100vh; padding-bottom: 90px; color: #134e4a; }
        .header { position: fixed; top: 0; left: 0; right: 0; height: 70px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(13, 148, 136, 0.1); display: flex; align-items: center; justify-content: center; z-index: 100; font-size: 1.3rem; font-weight: 800; color: #0D9488; }
        .content { margin-top: 90px; padding: 0 20px; max-width: 800px; margin-left: auto; margin-right: auto; }
        .status-card { background: white; border-radius: 24px; padding: 30px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 2px solid transparent; }
        .status-card.pending { border-color: #f59e0b; background: linear-gradient(135deg, #fffbeb, #ffffff); }
        .status-card.verified { border-color: #22c55e; background: linear-gradient(135deg, #f0fdf4, #ffffff); }
        .status-icon { width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 20px; }
        .status-card.pending .status-icon { background: #fef3c7; color: #d97706; animation: pulse 2s infinite; }
        .status-card.verified .status-icon { background: #dcfce7; color: #16a34a; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .status-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 10px; color: #0f172a; }
        .status-text { color: #64748b; line-height: 1.6; }
        .form-section { background: white; border-radius: 24px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f1f5f9; }
        .section-number { width: 35px; height: 35px; background: linear-gradient(135deg, #0D9488, #14B8A6); color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        .section-title { font-size: 1.2rem; font-weight: 800; color: #0f172a; }
        .form-grid { display: grid; gap: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-label { font-weight: 700; color: #475569; font-size: 0.9rem; }
        .form-input { padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; outline: none; transition: all 0.3s; }
        .form-input:focus { border-color: #14B8A6; box-shadow: 0 0 0 4px rgba(20, 184, 166, 0.1); }
        .submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #0D9488, #14B8A6); color: white; border: none; border-radius: 16px; font-size: 1.1rem; font-weight: 800; cursor: pointer; margin-top: 20px; box-shadow: 0 10px 20px rgba(13, 148, 136, 0.3); transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(13, 148, 136, 0.1); display: flex; justify-content: space-around; padding: 10px 0 20px; z-index: 100; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; padding: 8px; color: #94a3b8; text-decoration: none; font-size: 0.75rem; font-weight: 700; }
        .nav-item.active { color: #0D9488; background: rgba(13, 148, 136, 0.1); border-radius: 12px; }
        .loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 9999; display: none; align-items: center; justify-content: center; flex-direction: column; color: white; }
        .loading-overlay.active { display: flex; }
        .spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.2); border-top-color: #14B8A6; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast-container { position: fixed; top: 90px; right: 20px; z-index: 10000; }
        .toast { background: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideIn 0.3s; border-left: 4px solid #22c55e; display: flex; align-items: center; gap: 12px; }
        @keyframes slideIn { from { transform: translateX(400px); } to { transform: translateX(0); } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Submitting Details...</p>
    </div>
    <div class="toast-container" id="toastContainer"></div>
    <header class="header">KYC Verification</header>

    <div class="content" id="content">
        </div>

    <nav class="bottom-nav">
        <a href="dashboard.html" class="nav-item"><i class="fa-solid fa-house"></i><span>Home</span></a>
        <a href="earnings.html" class="nav-item"><i class="fa-solid fa-wallet"></i><span>Earnings</span></a>
        <a href="reviews.html" class="nav-item"><i class="fa-solid fa-star"></i><span>Reviews</span></a>
        <a href="kyc.html" class="nav-item active"><i class="fa-solid fa-id-card"></i><span>KYC</span></a>
        <a href="profile.html" class="nav-item"><i class="fa-solid fa-user"></i><span>Profile</span></a>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
            authDomain: "urban-paint-pro.firebaseapp.com",
            databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "urban-paint-pro",
            storageBucket: "urban-paint-pro.firebasestorage.app",
            messagingSenderId: "929763117480",
            appId: "1:929763117480:web:560057baeb12672078b59d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let currentUser = null;
        let kycData = {};

        auth.onAuthStateChanged(async user => {
            if (!user) { window.location.href = 'index.html'; return; }
            currentUser = user;
            await loadKYCData();
        });

        async function loadKYCData() {
            const snapshot = await db.ref(`partners/${currentUser.uid}`).once('value');
            const data = snapshot.val() || {};
            kycData = data.kyc || {};
            renderPage(data.kycStatus || 'pending');
        }

        function renderPage(status) {
            const container = document.getElementById('content');
            const isVerified = status === 'verified';
            
            let html = `
                <div class="status-card ${isVerified ? 'verified' : 'pending'}">
                    <div class="status-icon"><i class="fa-solid ${isVerified ? 'fa-check-circle' : 'fa-clock'}"></i></div>
                    <div class="status-title">${isVerified ? 'Verified' : 'Verification Pending'}</div>
                    <p class="status-text">${isVerified ? 'Account verified.' : 'Fill details below.'}</p>
                </div>`;

            if (!isVerified) {
                html += `
                <div class="form-section">
                    <div class="section-header"><div class="section-number">1</div><div class="section-title">Personal Info</div></div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Full Name</label><input type="text" class="form-input" id="kycName" value="${kycData.name || ''}"></div>
                        <div class="form-group"><label class="form-label">Aadhar Number</label><input type="text" class="form-input" id="kycAadhar" value="${kycData.aadhar || ''}"></div>
                        <div class="form-group"><label class="form-label">PAN Number</label><input type="text" class="form-input" id="kycPan" value="${kycData.pan || ''}"></div>
                    </div>
                </div>
                <div class="form-section">
                    <div class="section-header"><div class="section-number">2</div><div class="section-title">Bank Details</div></div>
                    <div class="form-grid">
                        <div class="form-group"><label class="form-label">Account Holder</label><input type="text" class="form-input" id="bankName" value="${kycData.bankDetails?.name || ''}"></div>
                        <div class="form-group"><label class="form-label">Account Number</label><input type="text" class="form-input" id="bankAccount" value="${kycData.bankDetails?.account || ''}"></div>
                        <div class="form-group"><label class="form-label">IFSC Code</label><input type="text" class="form-input" id="bankIfsc" value="${kycData.bankDetails?.ifsc || ''}"></div>
                    </div>
                </div>
                <button class="submit-btn" onclick="submitKYC()"><i class="fa-solid fa-check"></i> Submit Details</button>`;
            } else {
                html += `<div class="form-section"><p><strong>Verified Name:</strong> ${kycData.name}</p></div>`;
            }
            container.innerHTML = html;
        }

        async function submitKYC() {
            const data = {
                name: document.getElementById('kycName').value,
                aadhar: document.getElementById('kycAadhar').value,
                pan: document.getElementById('kycPan').value.toUpperCase(),
                bankDetails: {
                    name: document.getElementById('bankName').value,
                    account: document.getElementById('bankAccount').value,
                    ifsc: document.getElementById('bankIfsc').value.toUpperCase()
                },
                submittedAt: firebase.database.ServerValue.TIMESTAMP
            };

            if (!data.name || !data.aadhar || !data.pan) { alert('Fill all fields'); return; }

            document.getElementById('loadingOverlay').classList.add('active');
            try {
                await db.ref(`partners/${currentUser.uid}/kyc`).update(data);
                await db.ref(`partners/${currentUser.uid}/kycStatus`).set('pending');
                document.getElementById('loadingOverlay').classList.remove('active');
                showToast('Submitted!');
                loadKYCData();
            } catch (e) { alert(e.message); document.getElementById('loadingOverlay').classList.remove('active'); }
        }

        function showToast(m) {
            const c = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerHTML = `<i class="fa-solid fa-check-circle"></i> <span>${m}</span>`;
            c.appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>
</html>
