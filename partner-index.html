<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Login | Refine Home Services</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --p: #0D9488; 
            --p-dark: #0F766E;
            --p-light: #14B8A6;
            --bg: #F0FDFA; 
            --card: #FFFFFF;
            --text: #134E4A;
            --text-light: #64748B;
            --border: #E2E8F0;
            --shadow: 0 10px 40px -10px rgba(13, 148, 136, 0.2);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { 
            background: linear-gradient(135deg, #F0FDFA 0%, #CCFBF1 100%); 
            min-height: 100vh;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        
        .container { 
            background: var(--card); 
            padding: 40px 30px; 
            border-radius: 28px; 
            width: 100%; 
            max-width: 420px; 
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.8);
        }
        
        .logo { 
            text-align: center; 
            margin-bottom: 32px; 
        }
        
        .logo-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 2rem;
            box-shadow: 0 8px 20px rgba(13, 148, 136, 0.3);
        }
        
        .logo h2 { 
            color: var(--text); 
            font-size: 1.5rem;
            font-weight: 800;
        }
        
        .logo p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 4px;
        }
        
        .input-group { 
            margin-bottom: 20px; 
            position: relative;
        }
        
        .input-group i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .input-field { 
            width: 100%; 
            padding: 14px 16px 14px 48px; 
            border: 2px solid var(--border); 
            border-radius: 14px; 
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #F8FAFC;
        }
        
        .input-field:focus { 
            outline: none; 
            border-color: var(--p);
            background: white;
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
        }
        
        select.input-field {
            padding-left: 16px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
        }
        
        .btn { 
            width: 100%; 
            padding: 16px; 
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%); 
            color: white; 
            border: none; 
            border-radius: 14px; 
            font-weight: 700; 
            font-size: 1rem;
            cursor: pointer; 
            margin-top: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(13, 148, 136, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(13, 148, 136, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-google { 
            background: white; 
            color: #334155; 
            border: 2px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px; 
            margin-top: 12px; 
        }
        
        .btn-google:hover {
            background: #F8FAFC;
            border-color: #CBD5E1;
        }
        
        .toggle-text { 
            text-align: center; 
            margin-top: 24px; 
            cursor: pointer; 
            color: var(--text-light);
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .toggle-text span {
            color: var(--p);
            text-decoration: underline;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-container {
            background: white;
            border-radius: 24px;
            padding: 32px;
            width: 100%;
            max-width: 360px;
            text-align: center;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .modal-overlay.active .modal-container {
            transform: scale(1) translateY(0);
        }
        
        .modal-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 1.8rem;
        }
        
        .modal-icon.success { background: #DCFCE7; color: #16A34A; }
        .modal-icon.error { background: #FEF2F2; color: #EF4444; }
        .modal-icon.warning { background: #FFF7ED; color: #F97316; }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1E293B;
            margin-bottom: 8px;
        }
        
        .modal-text {
            color: #64748B;
            font-size: 0.95rem;
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .modal-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--p) 0%, var(--p-light) 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-weight: 700;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fa-solid fa-paint-roller"></i>
            </div>
            <h2>Partner Portal</h2>
            <p>Join our professional network</p>
        </div>
        
        <div id="loginForm">
            <div class="input-group">
                <i class="fa-solid fa-envelope"></i>
                <input type="email" id="l_email" class="input-field" placeholder="Email Address">
            </div>
            <div class="input-group">
                <i class="fa-solid fa-lock"></i>
                <input type="password" id="l_pass" class="input-field" placeholder="Password">
            </div>
            <button class="btn" onclick="login()" id="loginBtn">
                Login
            </button>
            <button class="btn btn-google" onclick="googleLogin()">
                <img src="https://cdn-icons-png.flaticon.com/512/300/300221.png" width="20"> Continue with Google
            </button>
            <p class="toggle-text" onclick="toggleForms()">New Partner? <span>Register Now</span></p>
        </div>

        <div id="signupForm" style="display:none;">
            <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="s_name" class="input-field" placeholder="Full Name">
            </div>
            <div class="input-group">
                <i class="fa-solid fa-envelope"></i>
                <input type="email" id="s_email" class="input-field" placeholder="Email Address">
            </div>
            <div class="input-group">
                <i class="fa-solid fa-phone"></i>
                <input type="tel" id="s_phone" class="input-field" placeholder="Mobile Number">
            </div>
            <div class="input-group">
                <select id="s_category" class="input-field">
                    <option value="" disabled selected>Select Your Category</option>
                    <option value="painting">Painting</option>
                    <option value="cleaning">Cleaning</option>
                    <option value="electrician">Electrician</option>
                    <option value="plumber">Plumber</option>
                    <option value="carpenter">Carpenter</option>
                    <option value="ac">AC Repair</option>
                    <option value="pest">Pest Control</option>
                    <option value="waterproofing">Waterproofing</option>
                </select>
            </div>
            <div class="input-group">
                <i class="fa-solid fa-location-dot"></i>
                <input type="text" id="s_city" class="input-field" placeholder="Work City">
            </div>
            <div class="input-group">
                <i class="fa-solid fa-lock"></i>
                <input type="password" id="s_pass" class="input-field" placeholder="Create Password">
            </div>
            <button class="btn" onclick="signup()" id="signupBtn">Create Account</button>
            <p class="toggle-text" onclick="toggleForms()">Already registered? <span>Login</span></p>
        </div>
    </div>

    <!-- Custom Modal -->
    <div class="modal-overlay" id="customModal">
        <div class="modal-container">
            <div class="modal-icon" id="modalIcon">
                <i class="fa-solid fa-check"></i>
            </div>
            <div class="modal-title" id="modalTitle">Success</div>
            <div class="modal-text" id="modalText">Operation completed</div>
            <button class="modal-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCmqBL6a0muExq2qBsSR6M3C_8AyXcJ2k8",
            authDomain: "urban-paint-pro.firebaseapp.com",
            databaseURL: "https://urban-paint-pro-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "urban-paint-pro",
            storageBucket: "urban-paint-pro.firebasestorage.app",
            messagingSenderId: "929763117480",
            appId: "1:929763117480:web:560057baeb12672078b59d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const provider = new firebase.auth.GoogleAuthProvider();

        function toggleForms() {
            const login = document.getElementById('loginForm');
            const signup = document.getElementById('signupForm');
            if(login.style.display === 'none') { 
                login.style.display = 'block'; 
                signup.style.display = 'none'; 
            }
            else { 
                login.style.display = 'none'; 
                signup.style.display = 'block'; 
            }
        }

        function showModal(title, text, type) {
            const modal = document.getElementById('customModal');
            const icon = document.getElementById('modalIcon');
            const titleEl = document.getElementById('modalTitle');
            const textEl = document.getElementById('modalText');
            
            titleEl.textContent = title;
            textEl.textContent = text;
            icon.className = 'modal-icon ' + type;
            
            if(type === 'success') icon.innerHTML = '<i class="fa-solid fa-check"></i>';
            else if(type === 'error') icon.innerHTML = '<i class="fa-solid fa-xmark"></i>';
            else if(type === 'warning') icon.innerHTML = '<i class="fa-solid fa-exclamation"></i>';
            
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('customModal').classList.remove('active');
        }

        function setLoading(btnId, isLoading) {
            const btn = document.getElementById(btnId);
            if(isLoading) {
                btn.disabled = true;
                btn.innerHTML += '<span class="loading"></span>';
            } else {
                btn.disabled = false;
                btn.innerHTML = btn.innerHTML.replace('<span class="loading"></span>', '');
            }
        }

        function signup() {
            const email = document.getElementById('s_email').value;
            const pass = document.getElementById('s_pass').value;
            const name = document.getElementById('s_name').value;
            const phone = document.getElementById('s_phone').value;
            const category = document.getElementById('s_category').value;
            const city = document.getElementById('s_city').value;

            if(!name || !email || !pass || !phone || !category || !city) {
                showModal('Missing Information', 'Please fill all fields', 'warning');
                return;
            }

            setLoading('signupBtn', true);

            auth.createUserWithEmailAndPassword(email, pass).then((cred) => {
                const user = cred.user;
                const partnerData = {
                    id: user.uid, 
                    name, 
                    email, 
                    phone, 
                    city: city.toLowerCase(),
                    category: category,
                    kycStatus: 'pending',
                    rating: 5.0, 
                    earnings: 0,
                    withdrawn: 0,
                    jobsCompleted: 0,
                    joinedAt: firebase.database.ServerValue.TIMESTAMP
                };
                db.ref('partners/' + user.uid).set(partnerData).then(() => {
                    localStorage.setItem('partnerData', JSON.stringify(partnerData));
                    showModal('Welcome!', 'Account created successfully', 'success');
                    setTimeout(() => window.location.href = 'partner-dashboard.html', 1500);
                });
            }).catch(e => {
                setLoading('signupBtn', false);
                showModal('Error', e.message, 'error');
            });
        }

        function login() {
            const email = document.getElementById('l_email').value;
            const pass = document.getElementById('l_pass').value;
            
            if(!email || !pass) {
                showModal('Missing Information', 'Please enter email and password', 'warning');
                return;
            }

            setLoading('loginBtn', true);
            
            auth.signInWithEmailAndPassword(email, pass).then((cred) => handleAuth(cred.user))
                .catch(e => {
                    setLoading('loginBtn', false);
                    showModal('Login Failed', e.message, 'error');
                });
        }

        function googleLogin() {
            auth.signInWithPopup(provider).then((result) => {
                db.ref('partners/' + result.user.uid).once('value').then(snap => {
                    if(snap.exists()) {
                        handleAuth(result.user);
                    } else {
                        showModal('Registration Required', 'Please register first with your category', 'warning');
                    }
                });
            }).catch(e => showModal('Error', e.message, 'error'));
        }

        function handleAuth(user) {
            db.ref('partners/' + user.uid).once('value').then(snap => {
                if(snap.exists()) {
                    localStorage.setItem('partnerData', JSON.stringify(snap.val()));
                    window.location.href = 'partner-dashboard.html';
                } else {
                    showModal('Profile Not Found', 'Partner profile not found', 'error');
                }
            });
        }
    </script>
</body>
</html>
age, 'error'));
        }

        function checkPartnerExists(user) {
            db.ref('partners').orderByChild('email').equalTo(user.email).once('value')
                .then(snapshot => {
                    if(snapshot.exists()) {
                        const partner = Object.values(snapshot.val())[0];
                        localStorage.setItem('partnerData', JSON.stringify(partner));
                        window.location.href = 'partner-dashboard.html';
                    } else {
                        showToast('Please register first', 'error');
                    }
                });
        }

        function handleRegister() {
            const name = document.getElementById('regName').value;
            const phone = document.getElementById('regPhone').value;
            const exp = document.getElementById('regExp').value;
            const city = document.getElementById('regCity').value;
            const pass = document.getElementById('regPass').value;

            if(!name || !phone || !selectedCategory || !exp || !city || !pass) {
                showToast('Please fill all fields', 'error');
                return;
            }

            const partnerData = {
                name,
                phone,
                category: selectedCategory,
                experience: parseInt(exp),
                city: city.toLowerCase(),
                password: pass,
                rating: 0,
                jobsCompleted: 0,
                earnings: 0,
                status: 'pending',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };

            const partnerId = db.ref('partners').push().key;
            db.ref('partners/' + partnerId).set(partnerData)
                .then(() => {
                    showToast('Registration successful! Please login.', 'success');
                    switchTab('login');
                })
                .catch(err => showToast(err.message, 'error'));
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fa-solid ${type === 'error' ? 'fa-circle-xmark' : type === 'success' ? 'fa-circle-check' : 'fa-circle-info'}" 
                   style="color: ${type === 'error' ? '#EF4444' : type === 'success' ? '#22C55E' : '#0D9488'}; font-size: 1.2rem;"></i>
                <div style="flex: 1; font-weight: 600;">${message}</div>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>
</html>